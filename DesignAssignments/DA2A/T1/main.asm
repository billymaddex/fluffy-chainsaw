;
; DA2AT1.asm
;
; Created: 9/29/2019 3:15:15 PM
; Author : Billy
;


; Set GPIO ports
	LDI		R25, 0x00
	OUT		DDRB, R25
	OUT		DDRC, R25
	OUT		DDRD, R25
	LDI		R25, 0xFF
	OUT		PORTB, R25
	OUT		PORTC, R25
	OUT		PORTD, R25
	SBI		DDRB, 3
	SBI		DDRB, 2
	CBI		DDRC, 3

MAIN_LOOP:
	CBI		PORTB, 3
	LDI		R17, HIGH(250)
	LDI		R16, LOW(250)
	CALL	DELAY
	SBI		PORTB, 3
	LDI		R17, HIGH(375)
	LDI		R16, LOW(375)
	CALL	DELAY

	SBIS	PINC, 3
	CALL	SWITCH_EVENT

	RJMP	MAIN_LOOP

SWITCH_EVENT:
	CBI		PORTB, 2
	LDI		R17, HIGH(1333)
	LDI		R16, LOW(1333)
	CALL	DELAY
	SBI		PORTB, 2

	RET

DELAY:
	LDI		R20, 0
	MOV		R22, R17
	MOV		R21, R16
L3:
	LDI		R23, 0X2F
L2:
	LDI		R24, 0X70
	NOP
L1:
	DEC		R24
	BRNE	L1
	DEC		R23
	BRNE	L2
	SUBI	R21, 1
	SBCI	R22, 0
	BRNE	L3
	CP		R21, R20
	BRNE	L3

	RET